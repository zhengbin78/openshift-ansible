---
# NOTE(shadower): we need to do this because some of the install tasks seem to
# ignore openshift_kubelet_name_override and rely on the actual system's hostname
- name: Update hostname to match the OpenStack name
  hostname:
    name: "{{ inventory_hostname }}"
  when: openshift_openstack_set_hostname_to_compute_name

- name: Ensure hostname in /etc/hosts
  lineinfile:
    dest: /etc/hosts
    state: present
    line: "{{ hostvars[item]['private_v4'] }} {{ hostvars[item]['ansible_hostname'] + '.' + openshift_openstack_full_dns_domain }}"
  with_items: "{{ groups['cluster_hosts'] }}"
  when: hostvars[item]['private_v4'] is defined
#- name: "Verify SELinux is enforcing"
#  fail:
#    msg: "SELinux is required for OpenShift and has been detected as '{{ ansible_selinux.config_mode }}'"
#  when: ansible_selinux.config_mode != "enforcing"

- include_tasks: container-storage-setup.yml
